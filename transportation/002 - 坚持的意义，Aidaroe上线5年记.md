### 起源

2013年我读大三，所学专业是交通工程，经常参与交叉口交通调查，主要内容是统计交叉口渠化设置，转向交通量，信号控制方案，评估交叉口延误、排队长度以及服务水平。我们在整理报告的阶段，用CAD绘制交叉口渠化、用PPT或者TC来画转向流量，用Synchro表达信号控制方案，评价结果用表格统计。尽管对学生而言，在过程中可以熟悉了解更多的专业软件，但也反映一个事实，缺乏采用良好的图形化形式的专业软件来有效地完成交叉口设置、评估表达。因此我萌发了能不能自己动手写一款交叉口评估分析的专业软件来解决上面问题，轻松快捷的实现交叉口渠化表达、生成交叉口转向流量图、展示信号控制方案，并内置交叉口评价算法实现饱和度、延误、排队长度和服务水平评估功能。

有了想法，动手实现对于那时读大三的我来说几乎是一件遥不可及的事情，因为编程基础非常薄弱，也不知道开发实现究竟要花费多少时间和精力。我把想法告诉了一些已经在工作的朋友，想听听他们的意见。印象最深刻的是一位江湖人称亮哥的老大哥给我讲了满汉全席的比喻：主要意思就是心里想的是做满汉全席，可能连蛋炒饭都做不出来，他可能觉得我就是一时兴起或者觉得这事情太大，难以完成，亮哥的满汉全席比喻我一直都记得，也提醒我做比说要重要。

### 尝试

开始尝试前，我认真研究了Sidra和Synchro两款做信号交叉口评估优化的软件，总结他们优点和缺点。我想要实现的软件功能内容比较多，先选择了相对容易的交叉口转向流量功能做尝试。交叉口转向流量展示功能核心就是根据交叉口各个方向的转向流量大小来自动绘制转向线条，线条的宽度代表流量的大小。

<img src="http://rbjz32stj.hn-bkt.clouddn.com/img/001.png" alt="001" style="zoom: 180%;" />

﻿﻿如何具体实现，我第一个想到用PPT或者Excel进行二次开发，用代码来控制插入线条形状位置宽度等，评估发现参数输入交互复杂，开发实现难度也大，也很难独立打包成应用。后面检索发现可以用C#的GDI绘图实现，语言本身也比较简单，最后选择C#开发实现。在开发实施过程中，原本以为画几条粗细不一的线上去，再添加上流量标签就能搞定的事情，却比想象的要麻烦得多。这是因为实际交叉口每条线条的起始点位置、宽度、曲率、与输入流量之间的关系等问题都需要解决，最头疼的问题是采用线性代数求解点位，会造成特殊角度计算结果不稳定，一个点位偏差就会造成整个绘制出错。经过很长一段时间优化完善，尽管仍然存在偶尔不稳定的状况，第一版交叉口转向流量图应用已经可以逐渐可以在一些实际项目中运用，功能界面效果如下。

<img src="http://rbjz32stj.hn-bkt.clouddn.com/img/002.png" alt="002"  
 style="zoom: 165%;"/>

### 拓展

经过使用反馈，桌面端的交叉口流量图应用在实际使用中还是存在着问题，即无法在xp、macOS和其它部分操作系统中正常使用。那时候web端在线应用逐渐增多，web应用优点是运行在浏览器环境中，打破了操作系统之间的限制，能够更灵活地适应用户需求。参考了html5中的canvas绘图功能，决定尝试开发web端的交叉口流量图应用。 由于之前没有接触过html5、css、js等，所以又开始一边学习，一边开发。web端应用分为前端和后端：前端canvas负责绘图，后端负责点位计算等。前端页面布局设计内容相对较少，主要通过html和css完成；前端绘图功能利用js控制canvas进行绘图完成，这个过程就是将之前在桌面端的核心代码用js实现了一遍。由于是第一次使用js语言来写应用，其整体语言风格跟C#存在较大差异，刚开始难以适应，编码质量也很差，开发进度缓慢。尽管进展缓慢，有了桌面端的开发经验，前端绘图功能总体进展还算顺利，终究还是将桌面端绘图功能用js语言实现了。Web端交叉口流量图功能开发的难点在于后台功能的开发，之前完全没有接触过后台开发，也不知道使用什么后台语言，经过一番对比，在php、java、Python和nodejs中最后选用了nodejs作为后台开发工具，选择nodejs最重要的原因是后台也可以用js实现，不用再去研究新的语言，开发速度会快一些。 选定nodejs作为后台开发后，紧接着就是学习nodejs的相关内容，感谢这个伟大的互联网时代，获取学习资料的难度比我想象中要小得多，一番学习之后搭建起了初步了web端交叉口流量图框架。Web端开发的最后一个难点就是将应用部署到服务器上，跟着网上的攻略买服务器、买域名、学习基本的linux系统操作命令，一切就绪之后，web端的交叉口流量图应用终于可以正式运行。

<img src="http://rbjz32stj.hn-bkt.clouddn.com/img/003.png" alt="003" 
     style="zoom: 180%;"/>

尽管现在回过头来看界面设计简直惨不忍睹，不过完成了从桌面端到web端的技术升级，走通了整个流程，完成上线后能正常访问心里还是有些小激动的。

### 攻坚

Web版交叉口流量图应用上线后，便开始准备开发交叉口渠化示意图功能。为了使得渠化示意图能最大程度的贴合实际交叉口，我重点参考了国标中关于交叉口标线相关的规范，借鉴了国标中交叉口示意图的绘图风格，并以此作为渠化示意图绘制的基本风格，功能上能够实现处理左转待转区、直行待转区、可变车道、公交专用道，右转渠化岛等。 

交叉口渠化示意图开发是整个交叉口评估软件最复杂的功能，需要计算的点位数远多于交叉口流量转向图，对点位计算的精度要求也更高，所以整体开发难度更大，加之期间有其他事情耽搁，开发周期相当漫长，交叉口渠化示意图最后上线测试也比预期推迟了很长一段时间。

<img src="http://rbjz32stj.hn-bkt.clouddn.com/img/004.png" alt="004"  
     style="zoom: 190%;"/>

上线测试一段时间后，根据大家的反馈，部分交叉口左转或者掉头半径不足时左转或掉头车道会被设置在进口道外侧。因此又增加了车道调整功能，通过点击箭头标志更换箭头类型，使其更加适应实际交叉口情况。

<img src="http://rbjz32stj.hn-bkt.clouddn.com/img/005.png" alt="004"  
     style="zoom: 190%;"/>





### 升级

完成交叉口渠化示意图开发后，下一个开发功能项就是交叉口信号配置方案。在开发交叉口信号配置方案前需要解决的问题就是软件整体UI设计了，流量图和渠化示意图界面看起来严重缺乏设计感，也不太满足软件交互需求。最开始我委托了其他人来设计整个软件的UI界面，不过尝试了好几个版本以后还是不能达到我的预期，不得已自己动手开始做。为此学习了一段时间界面设计，参考其他一些在线应用的界面设计风格，在AI中绘制了初始版本的界面。最终开发的UI界面在配色有一些优化调整，UI设计的效果是整个软件中最让我满意的地方，也是软件发布后受到很多业内专家老师认同最多的地方。

<img src="http://rbjz32stj.hn-bkt.clouddn.com/img/006.png" alt="004"  
     style="zoom: 190%;"/>


完成UI设计后，信号方案设置相对是比较简单的，因为涉及到的点位计算量是很小的，大概1个月就完成了整体的开发内容。交叉口信号方案一般由相位相序图和相位配时图组成，考虑非机动车相位、行人相位、搭接相位、待转相位等开发了信号方案设计模块。

<img src="http://rbjz32stj.hn-bkt.clouddn.com/img/007.png" alt="004"  
     style="zoom: 190%;"/>

完成信号方案设计模块后，开始开发评价分析功能。根据交叉口评价分析的实际需求，选择交叉口饱和度、延误、排队长度和服务水平作为评价分析指标，基于HCM2000手册中评价分析模型进行计算。结合项目报告中对评价分析结果图形化的需求，四个指标的评价结果均采用了图形化展示效果。

<img src="http://rbjz32stj.hn-bkt.clouddn.com/img/008.png" alt="004"  
     style="zoom: 190%;"/>



<img src="http://rbjz32stj.hn-bkt.clouddn.com/img/009.png" alt="004"  
     style="zoom: 190%;"/>

<img src="http://rbjz32stj.hn-bkt.clouddn.com/img/110.png" alt="004"  
     style="zoom: 190%;"/>

考虑到实际应用中对交叉口评价分析大多数需要对早高峰、平峰、晚高峰等情况进行评价分析，或者某个交叉口改造中不同方案的对比，交叉口应用支持对渠化、流量、信号等进行多方案设计，并可以在评价结果中直接对比分析不同方案，也支持将评价分析结果导出到excel中进一步处理分析。

<img src="http://rbjz32stj.hn-bkt.clouddn.com/img/111.png" alt="004"  
     style="zoom: 190%;"/>

### 心得

发布后很多朋友问我软件的名称为什么是Aidaroe这么一个奇怪的名字，我是根据交叉口评估分析助手英文简写（Assistant of Intersection evaluation and Analysis ），并参考SIDRA命名最后取名的Aidaroe，也考虑了当时域名的申请。

访问网址：[www.aidaroe.com](http://www.aidaroe.com)

介绍视频：https://v.qq.com/x/page/v0500e1vi8h.html

从萌发开发信号交叉口评价分析应用的想法到最后上线测试足足经历了三年多时间，从大四到研三，把一个简单的想法一步步实现，整个过程既充满挑战也收获不少。今年Aidaroe已经上线5年，注册用户超过1万，服务的交叉口接近4万。在这个小小的领域贡献了自己的力量，回望整个软件的开发历程，感受最深的就是不断拓展自己的知识边界，锤炼动手能力，保持一颗主动开放学习心态朝自己的树立的目标负重前行，达到目标的那一刻喜悦与被肯定才会真正理解坚持的意义。若有想法，就尽最大努力去实现，感谢这个伟大的互联网时代，有海量的学习资料供我们参考，真正阻碍前进的或许不再是专业技能、不是编程、不是某一个软件工具，而是勇往直前的决心和愿意背后付出的努力。